%!TeX root=../../../../exa-ma-d7.1.tex

\pgfplotstableread[col sep=comma]{chapters/applications/specs/data/app-feelpp-io/loadMeshP1.csv}\dataLoadMesh
\pgfplotstableread[col sep=comma]{chapters/applications/specs/data/app-feelpp-io/functionSpaceP1.csv}\dataFunctionSpace
\pgfplotstableread[col sep=comma]{chapters/applications/specs/data/app-feelpp-io/functionSpaceVP1.csv}\dataFunctionSpaceV
\pgfplotstableread[col sep=comma]{chapters/applications/specs/data/app-feelpp-io/saveMeshP1.csv}\dataSaveMesh
\pgfplotstableread[col sep=comma]{chapters/applications/specs/data/app-feelpp-io/exportFieldP1.csv}\dataExporField
\pgfplotstableread[col sep=comma]{chapters/applications/specs/data/app-feelpp-io/exportFieldVP1.csv}\dataExporFieldV
\pgfplotstableread[col sep=comma]{chapters/applications/specs/data/app-feelpp-io/exportDataP1.csv}\dataExportData




\begin{figure}
  \begin{subfigure}[c]{0.49\textwidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
      width=\textwidth, height=0.8\textwidth,
      xlabel={ \texttt{np} }, ylabel={ Time [s] },
      xtick=data, xtick align=outside,
      ymode=log,
      ymajorgrids=true, yminorgrids=true,
      xmajorgrids=true,
      xticklabels from table={\dataSaveMesh}{resources.tasks},
      cycle list name=color list,
      legend style={at={(0.99,0.99)}, anchor=north east}
    ]
      \addplot+[mark=*, color=customdarkblue] table [x expr=\coordindex, y=M2] {\dataLoadMesh} ;
      \addlegendentry{ \texttt{M2} }
      \addplot+[mark=*, color=customcyan] table [x expr=\coordindex, y=M3] {\dataLoadMesh} ;
      \addlegendentry{ \texttt{M3} }
      \addplot+[mark=*, color=customorange] table [x expr=\coordindex, y=M4] {\dataLoadMesh} ;
      \addlegendentry{ \texttt{M4} }
      \addplot+[mark=*, color=custompurple] table [x expr=\coordindex, y=M5] {\dataLoadMesh} ;
      \addlegendentry{ \texttt{M5} }
    \end{axis}
    \end{tikzpicture}
    \caption{ Load the mesh. }
    \label{fig:specs:app-feelpp-io:np:loadmesh}
  \end{subfigure}
  \begin{subfigure}[c]{0.49\textwidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
      width=\textwidth, height=0.8\textwidth,
      xlabel={ \texttt{np} }, ylabel={ Time [s] },
      xtick=data, xtick align=outside,
      ymode=log,
      ymajorgrids=true, yminorgrids=true,
      xmajorgrids=true,
      xticklabels from table={\dataSaveMesh}{resources.tasks},
      cycle list name=color list,
      legend style={at={(0.99,0.99)}, anchor=north east}
    ]
      \addplot+[mark=*, color=customdarkblue] table [x expr=\coordindex, y=M2] {\dataSaveMesh} ;
      \addplot+[mark=*, color=customcyan] table [x expr=\coordindex, y=M3] {\dataSaveMesh} ;
      \addplot+[mark=*, color=customorange] table [x expr=\coordindex, y=M4] {\dataSaveMesh} ;
      \addplot+[mark=*, color=custompurple] table [x expr=\coordindex, y=M5] {\dataSaveMesh} ;
    \end{axis}
    \end{tikzpicture}
    \caption{ Save mesh at format HDF5 on disk. }
    \label{fig:specs:app-feelpp-io:np:savemesh}
  \end{subfigure}

  \begin{subfigure}[c]{0.49\textwidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
      width=\textwidth, height=0.8\textwidth,
      xlabel={ \texttt{np} }, ylabel={ Time [s] },
      xtick=data, xtick align=outside,
      ymode=log,
      ymajorgrids=true, yminorgrids=true,
      xmajorgrids=true,
      xticklabels from table={\dataFunctionSpace}{resources.tasks},
      cycle list name=color list,
      legend style={at={(0.99,0.99)}, anchor=north east}
    ]
      \addplot+[mark=*, color=customdarkblue] table [x expr=\coordindex, y=M2] {\dataFunctionSpace} ;
      \addplot+[mark=*, color=customcyan] table [x expr=\coordindex, y=M3] {\dataFunctionSpace} ;
      \addplot+[mark=*, color=customorange] table [x expr=\coordindex, y=M4] {\dataFunctionSpace} ;
      \addplot+[mark=*, color=custompurple] table [x expr=\coordindex, y=M5] {\dataFunctionSpace} ;
    \end{axis}
    \end{tikzpicture}
    \caption{ Create function space $X_h$. }
    \label{fig:specs:app-feelpp-io:np:functionspace}
  \end{subfigure}
  \begin{subfigure}[c]{0.49\textwidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
      width=\textwidth, height=0.8\textwidth,
      xlabel={ \texttt{np} }, ylabel={ Time [s] },
      xtick=data, xtick align=outside,
      ymode=log,
      ymajorgrids=true, yminorgrids=true,
      xmajorgrids=true,
      xticklabels from table={\dataFunctionSpaceV}{resources.tasks},
      cycle list name=color list,
      legend style={at={(0.99,0.99)}, anchor=north east}
    ]
      \addplot+[mark=*, color=customdarkblue] table [x expr=\coordindex, y=M2] {\dataFunctionSpaceV} ;
      \addplot+[mark=*, color=customcyan] table [x expr=\coordindex, y=M3] {\dataFunctionSpaceV} ;
      \addplot+[mark=*, color=customorange] table [x expr=\coordindex, y=M4] {\dataFunctionSpaceV} ;
      \addplot+[mark=*, color=custompurple] table [x expr=\coordindex, y=M5] {\dataFunctionSpaceV} ;
    \end{axis}
    \end{tikzpicture}
    \caption{ Create vector function space $\mathbf{X}_h$. }
    \label{fig:specs:app-feelpp-io:np:functionspaceV}
  \end{subfigure}

  \begin{subfigure}[c]{0.33\textwidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
      width=\textwidth, height=1.3\textwidth,
      xlabel={ \texttt{np} }, ylabel={ Time [s] },
      xtick=data, xtick align=outside,
      ymode=log, ymax=1,
      ymajorgrids=true, yminorgrids=true,
      xmajorgrids=true,
      xticklabels from table={\dataExporField}{resources.tasks},
      cycle list name=color list,
      legend style={at={(0.99,0.99)}, anchor=north east}
    ]
      \addplot+[mark=*, color=customdarkblue] table [x expr=\coordindex, y=M2] {\dataExporField} ;
      \addplot+[mark=*, color=customcyan] table [x expr=\coordindex, y=M3] {\dataExporField} ;
      \addplot+[mark=*, color=customorange] table [x expr=\coordindex, y=M4] {\dataExporField} ;
      \addplot+[mark=*, color=custompurple] table [x expr=\coordindex, y=M5] {\dataExporField} ;
    \end{axis}
    \end{tikzpicture}
    \caption{ Export the field $u$ at HDF5 format on disk. }
    \label{fig:specs:app-feelpp-io:np:exportfield}
  \end{subfigure}
  \begin{subfigure}[c]{0.33\textwidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
      width=\textwidth, height=1.3\textwidth,
      xlabel={ \texttt{np} }, ylabel={ Time [s] },
      xtick=data, xtick align=outside,
      ymode=log,
      ymajorgrids=true, yminorgrids=true,
      xmajorgrids=true,
      xticklabels from table={\dataExporFieldV}{resources.tasks},
      cycle list name=color list,
      legend style={at={(0.99,0.99)}, anchor=north east}
    ]
      \addplot+[mark=*, color=customdarkblue] table [x expr=\coordindex, y=M2] {\dataExporFieldV} ;
      \addplot+[mark=*, color=customcyan] table [x expr=\coordindex, y=M3] {\dataExporFieldV} ;
      \addplot+[mark=*, color=customorange] table [x expr=\coordindex, y=M4] {\dataExporFieldV} ;
      \addplot+[mark=*, color=custompurple] table [x expr=\coordindex, y=M5] {\dataExporFieldV} ;
    \end{axis}
    \end{tikzpicture}
    \caption{ Export the vector field $\mathbf{u}$ at HDF5 format on disk. }
    \label{fig:specs:app-feelpp-io:np:exportfieldv}
  \end{subfigure}
  \begin{subfigure}[c]{0.33\textwidth}
    \centering
    \begin{tikzpicture}
    \begin{axis}[
      width=\textwidth, height=1.3\textwidth,
      xlabel={ \texttt{np} }, ylabel={ Time [s] },
      xtick=data, xtick align=outside,
      ymode=log, ymin=1, ymax=100,
      ymajorgrids=true, yminorgrids=true,
      xmajorgrids=true,
      xticklabels from table={\dataExportData}{resources.tasks},
      cycle list name=color list,
      legend style={at={(0.99,0.99)}, anchor=north east}
    ]
      \addplot+[mark=*, color=customdarkblue] table [x expr=\coordindex, y=M2] {\dataExportData} ;
      \addplot+[mark=*, color=customcyan] table [x expr=\coordindex, y=M3] {\dataExportData} ;
      \addplot+[mark=*, color=customorange] table [x expr=\coordindex, y=M4] {\dataExportData} ;
      \addplot+[mark=*, color=custompurple] table [x expr=\coordindex, y=M5] {\dataExportData} ;
    \end{axis}
    \end{tikzpicture}
    \caption{ Ensight export of the vectors $u$ and $\mathbf{u}$ and the mesh on disk. }
    \label{fig:specs:app-feelpp-io:np:export}
  \end{subfigure}
  \caption{Profiling times for the mini-app \texttt{app-feelpp-io}, run on Gaya, at a fixed discretization order ($\mathP_1$). The colors of the plots correspond to the mesh used, as described in the legend of \Cref{fig:specs:app-feelpp-io:np:loadmesh}.}
  \label{fig:specs:app-feelpp-io:np}
\end{figure}
